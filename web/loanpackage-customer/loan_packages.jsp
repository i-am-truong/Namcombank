<%@ page import="java.sql.*, java.util.*" %>
<%@ page import="model.LoanPackage" %>
<%@ page import="context.LoanPackageDAO" %>
<%@ page import="model.Customer" %>
<%@ page session="true" %>
<%@ page contentType="text/html; charset=UTF-8" %>

<%
    // Ki·ªÉm tra ng∆∞·ªùi d√πng c√≥ ƒëƒÉng nh·∫≠p kh√¥ng
    Customer customer = (Customer) session.getAttribute("customer");
    boolean isLoggedIn = (customer != null);
%>

<!DOCTYPE html>
<html lang="vi">
    <head>
        <title>Danh s√°ch G√≥i Vay</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    </head>
    <body class="bg-light">
        <div class="container mt-5">
            <!-- Thanh ƒëi·ªÅu h∆∞·ªõng v·ªõi n√∫t Home v√† Xem Y√™u C·∫ßu Vay -->
            <div class="d-flex justify-content-between mb-4">
                <div>
                    <a href="../Home" class="btn btn-secondary">üè† Home</a>
                    <% if (isLoggedIn) { %>
                    <a href="../customer-loan-requests" class="btn btn-info">üìÑ Xem Y√™u C·∫ßu Vay</a>
                    <% } %>
                </div>
                <h2 class="text-center flex-grow-1">Danh s√°ch G√≥i Vay</h2>
            </div>

            <div class="table-responsive">
                <table class="table table-bordered table-hover bg-white shadow">
                    <thead class="table-primary text-center">
                        <tr>
                            <th>T√™n G√≥i</th>
                            <th>Lo·∫°i Vay</th>
                            <th>M√¥ T·∫£</th>
                            <th>L√£i Su·∫•t (%)</th>
                            <th>S·ªë Ti·ªÅn T·ªëi Thi·ªÉu</th>
                            <th>S·ªë Ti·ªÅn T·ªëi ƒêa</th>
                            <th>Th·ªùi H·∫°n Vay</th>
                            <th>H√†nh ƒë·ªông</th>
                        </tr>
                    </thead>
                    <tbody>
                        <%
                            LoanPackageDAO dao = new LoanPackageDAO();
                            List<LoanPackage> packages = dao.getAllLoanPackages();
                            for (LoanPackage loan : packages) {
                        %>
                        <tr class="text-center">
                            <td><%= loan.getPackageName() %></td>
                            <td><%= loan.getLoanType() %></td>
                            <td><%= loan.getDescription() %></td>
                            <td><%= loan.getInterestRate() %></td>
                            <td><%= loan.getMinAmount() %></td>
                            <td><%= loan.getMaxAmount() %></td>
                            <td><%= loan.getLoanTerm() %> th√°ng</td>
                            <td>
                                <% if (isLoggedIn) { %>
                                <!-- N·∫øu ƒë√£ ƒëƒÉng nh·∫≠p, cho ph√©p ƒëƒÉng k√Ω vay -->
                                <form action="create-loan-request.jsp" method="GET">
                                    <input type="hidden" name="package_id" value="<%= loan.getPackageId() %>">
                                    <button type="submit" class="btn btn-primary">ƒêƒÉng k√Ω vay</button>
                                </form>
                                <% } else { %>
                                <!-- N·∫øu ch∆∞a ƒëƒÉng nh·∫≠p, y√™u c·∫ßu ƒëƒÉng nh·∫≠p tr∆∞·ªõc -->
                                <a href="../login" class="btn btn-warning">ƒêƒÉng nh·∫≠p ƒë·ªÉ vay</a>
                                <% } %>
                            </td>
                        </tr>
                        <% } %>
                    </tbody>
                </table>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    </body>
</html>
